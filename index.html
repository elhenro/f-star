<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/planck-js@0.2/dist/planck-with-testbed.js"></script>
<script>
    planck.testbed('ConveyorBelt', function(testbed) {
        var pl = planck, Vec2 = pl.Vec2;
        var world = new pl.World(Vec2(0, -10));

        // Ground
        var ground = world.createBody();
        ground.createFixture(pl.Edge(Vec2(-20.0, 0.0), Vec2(20.0, 0.0)), 0.0);

        // Platform
        var platform = world
            .createBody(Vec2(-5.0, 5.0))
            .createFixture(pl.Box(10.0, 0.5), {friction : 0.8});

        // Boxes
        for (var i = 0; i < 5; ++i) {
            world.createDynamicBody(Vec2(-10.0 + 2.0 * i, 7.0))
                .createFixture(pl.Box(0.5, 0.5), 20.0);
        }

        world.on('pre-solve', function(contact, oldManifold) {
            var fixtureA = contact.getFixtureA();
            var fixtureB = contact.getFixtureB();

            if (fixtureA == platform) {
                contact.setTangentSpeed(5.0);
            }

            if (fixtureB == platform) {
                contact.setTangentSpeed(-5.0);
            }
        });

        return world;
    });
</script>
</body>
</html>

